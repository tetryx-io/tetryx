ARG BASE_IMAGE=us-west1-docker.pkg.dev/atrium-ai/dock/atrium/web/base:latest
FROM ${BASE_IMAGE} as atrium-app

ENV APP_HOME /app
WORKDIR $APP_HOME

COPY . .

ARG NEXT_PUBLIC_API_BASE_URL=https://api.atrium.st/v0
ARG NEXT_PUBLIC_GOOGLE_ANALYTICS=475018656
ARG NEXT_PUBLIC_GA_MEASUREMENT_ID=G-KQSFTFZ028
ARG NEXT_PUBLIC_POSTHOG_KEY=phc_mavecFSosbxGMyxnUxiaUHNOS1NVjI3xi4QLlGOSH7k
ARG NEXT_PUBLIC_POSTHOG_HOST=https://us.i.posthog.com



# Add the API base URL to the environment variables.
ENV NEXT_PUBLIC_API_BASE_URL=${NEXT_PUBLIC_API_BASE_URL}
ENV NEXT_PUBLIC_GOOGLE_ANALYTICS=${NEXT_PUBLIC_GOOGLE_ANALYTICS}
ENV NEXT_PUBLIC_GA_MEASUREMENT_ID=${NEXT_PUBLIC_GA_MEASUREMENT_ID}
ENV NEXT_PUBLIC_POSTHOG_KEY=${NEXT_PUBLIC_POSTHOG_KEY}
ENV NEXT_PUBLIC_POSTHOG_HOST=${NEXT_PUBLIC_POSTHOG_HOST}


# Install any new packages.
RUN YARN_CACHE_FOLDER=/root/.yarn yarn --frozen-lockfile

RUN yarn build

CMD yarn start -p 8080
